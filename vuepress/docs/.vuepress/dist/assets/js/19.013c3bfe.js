(window.webpackJsonp=window.webpackJsonp||[]).push([[19],{306:function(s,a,t){"use strict";t.r(a);var e=t(6),n=Object(e.a)({},function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h1",{attrs:{id:"elasticsearch"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#elasticsearch","aria-hidden":"true"}},[s._v("#")]),s._v(" ElasticSearch")]),s._v(" "),t("div",{staticClass:"tip custom-block"},[t("p",{staticClass:"custom-block-title"},[s._v("提示")]),s._v(" "),t("p",[s._v("可选组件, 基于spring boot 2.3.x\n用途：")]),s._v(" "),t("ul",[t("li",[s._v("日志管理")])])]),s._v(" "),t("h2",{attrs:{id:"安装"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#安装","aria-hidden":"true"}},[s._v("#")]),s._v(" 安装")]),s._v(" "),t("ul",[t("li",[t("a",{attrs:{href:"https://artifacts.elastic.co/downloads/elasticsearch/elasticsearch-7.6.2-linux-x86_64.tar.gz",target:"_blank",rel:"noopener noreferrer"}},[s._v("下载v7.6.2"),t("OutboundLink")],1)]),s._v(" "),t("li",[t("a",{attrs:{href:"https://www.newbe.pro/Mirrors/Mirrors-Elasticsearch/",target:"_blank",rel:"noopener noreferrer"}},[s._v("推荐-国内镜像"),t("OutboundLink")],1)])]),s._v(" "),t("p",[s._v("解压")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("unzip elasticsearch-7.6.2.zip\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("默认elasticsearch禁止root运行, 所有需要添加用户")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("groupadd")]),s._v(" elsearch\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("useradd")]),s._v(" elsearch -g elsearch -p elasticsearch\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[s._v("更改文件夹及内部文件的所属用户及组为elsearch:elsearch")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("chown")]),s._v(" -R elsearch:elsearch elasticsearch-7.6.2\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("如果默认目录为/root/elasticsearch-7.6.2/, 需要迁移到/home/elasticsearch-7.6.2/")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("cd")]),s._v(" /home\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("mv")]),s._v(" /root/elasticsearch-7.6.2/ "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v(".")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("cd")]),s._v(" elasticsearch-7.6.2/\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("p",[s._v("修改 max file descriptors")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("su")]),s._v(" root\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("vi")]),s._v(" /etc/security/limits.conf\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 文件末尾添加")]),s._v("\nelsearch soft nofile 65536\nelsearch hard nofile 65536\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("p",[s._v("修改 max_map_count")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("vi")]),s._v(" /etc/sysctl.conf\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 添加下面配置：")]),s._v("\nvm.max_map_count"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("655360\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 并执行命令：")]),s._v("\nsysctl -p\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("p",[s._v("开启远程访问")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("vi")]),s._v(" config/elasticsearch.yml\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 修改为")]),s._v("\ncluster.name: elasticsearch\nnetwork.host: 0.0.0.0\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 防止默认使用阿里云内网ip")]),s._v("\nnetwork.publish_host: 外网ip\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 添加配置")]),s._v("\nnode.name: "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"node-1"')]),s._v("\ndiscovery.seed_hosts: "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"127.0.0.1"')]),s._v(", "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"[::1]"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\ncluster.initial_master_nodes: "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"node-1"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 开启跨域访问支持，默认为false（可选）")]),s._v("\nhttp.cors.enabled: "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 跨域访问允许的域名地址，(允许所有域名)以上使用正则（可选）")]),s._v("\nhttp.cors.allow-origin: /.*/\nhttp.cors.allow-headers: Authorization\nxpack.security.enabled: "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\nxpack.security.transport.ssl.enabled: "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br")])]),t("p",[s._v("中文分词(可选)")]),s._v(" "),t("ul",[t("li",[t("a",{attrs:{href:"https://github.com/medcl/elasticsearch-analysis-ik",target:"_blank",rel:"noopener noreferrer"}},[s._v("ik帮助文档"),t("OutboundLink")],1)]),s._v(" "),t("li",[t("a",{attrs:{href:"https://github.com/medcl/elasticsearch-analysis-ik/releases/download/v7.6.2/elasticsearch-analysis-ik-7.6.2.zip",target:"_blank",rel:"noopener noreferrer"}},[s._v("下载中文分词v7.6.2"),t("OutboundLink")],1)])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 安装方法一")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("cd")]),s._v(" /home/elasticsearch-7.6.2/plugins\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" ik\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("cd")]),s._v(" ik\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 上传elasticsearch-analysis-ik-7.6.2.zip到ik目录，并解压")]),s._v("\nunzip elasticsearch-analysis-ik-7.6.2.zip\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 或 安装方法二")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("cd")]),s._v(" /home/elasticsearch-7.6.2\n./bin/elasticsearch-plugin "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" https://github.com/medcl/elasticsearch-analysis-ik/releases/download/v7.6.2/elasticsearch-analysis-ik-7.6.2.zip\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 重启elasticsearch")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br")])]),t("p",[s._v("切换到elsearch用户，并启动")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("su")]),s._v(" elsearch\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 前台启动：")]),s._v("\n./bin/elasticsearch\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 后台启动：")]),s._v("\n./bin/elasticsearch -d\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 退出")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("exit")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br")])]),t("p",[s._v("用户授权")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 设置用户名/密码")]),s._v("\n./bin/elasticsearch-setup-passwords interactive\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 按提示设置密码")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("p",[s._v("浏览器中打开")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 其中：127.0.0.1替换为真实服务器ip")]),s._v("\nhttp://127.0.0.1:9200/\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 端口9200用于rest api接口，9300用于集群结点之间通信")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("h2",{attrs:{id:"项目中配置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#项目中配置","aria-hidden":"true"}},[s._v("#")]),s._v(" 项目中配置")]),s._v(" "),t("p",[s._v("项目pom.xml中添加")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("dependency"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("groupId"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("org.springframework.boot"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/groupId"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("artifactId"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("spring-boot-starter-data-elasticsearch"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/artifactId"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/dependency"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("p",[s._v("项目application.properties中添加")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("spring.data.elasticsearch.cluster-name"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("elasticsearch\nspring.data.elasticsearch.repositories.enabled"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("true\nspring.data.elasticsearch.cluster-nodes"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("127.0.0.1:9300\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\nspring.elasticsearch.rest.uris"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("127.0.0.1:9200\nspring.elasticsearch.rest.read-timeout"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("10000\nspring.elasticsearch.rest.username"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("\nspring.elasticsearch.rest.password"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br")])]),t("h2",{attrs:{id:"常见问题"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#常见问题","aria-hidden":"true"}},[s._v("#")]),s._v(" 常见问题")]),s._v(" "),t("p",[s._v("本地测试报错")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("flood stage disk watermark "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("95%"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" exceeded on "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("nCxquc7PTxKvs6hLkfonvg"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("nCxquc7"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("/usr/local/var/lib/elasticsearch/nodes/0"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" free: 15.3gb"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("4.1%"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(", all indices on this node will be marked read-only\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("解决方法")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" -XPUT -H "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Content-Type: application/json"')]),s._v(" http://localhost:9200/_cluster/settings -d "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('\'{ "transient": { "cluster.routing.allocation.disk.threshold_enabled": false } }\'')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" -XPUT -H "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Content-Type: application/json"')]),s._v(" http://localhost:9200/_all/_settings -d "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'{\"index.blocks.read_only_allow_delete\": null}'")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("h2",{attrs:{id:"参考"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#参考","aria-hidden":"true"}},[s._v("#")]),s._v(" 参考")])])},[],!1,null,null,null);a.default=n.exports}}]);