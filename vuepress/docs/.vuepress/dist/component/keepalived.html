<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>KeepAlived | 虾婆</title>
    <meta name="description" content="企业级开源即时通讯解决方案">
    
    
    <link rel="preload" href="/xiaper.io/assets/css/0.styles.111411e0.css" as="style"><link rel="preload" href="/xiaper.io/assets/js/app.8a36be63.js" as="script"><link rel="preload" href="/xiaper.io/assets/js/2.00a3d842.js" as="script"><link rel="preload" href="/xiaper.io/assets/js/20.570c8361.js" as="script"><link rel="prefetch" href="/xiaper.io/assets/js/10.109079b6.js"><link rel="prefetch" href="/xiaper.io/assets/js/11.2fff1b37.js"><link rel="prefetch" href="/xiaper.io/assets/js/12.70cd5b9b.js"><link rel="prefetch" href="/xiaper.io/assets/js/13.4304d67d.js"><link rel="prefetch" href="/xiaper.io/assets/js/14.080e4058.js"><link rel="prefetch" href="/xiaper.io/assets/js/15.2b8b0a45.js"><link rel="prefetch" href="/xiaper.io/assets/js/16.8df0dc17.js"><link rel="prefetch" href="/xiaper.io/assets/js/17.54fa263f.js"><link rel="prefetch" href="/xiaper.io/assets/js/18.0bfe0cf9.js"><link rel="prefetch" href="/xiaper.io/assets/js/19.9d9f20fd.js"><link rel="prefetch" href="/xiaper.io/assets/js/21.069eeccf.js"><link rel="prefetch" href="/xiaper.io/assets/js/22.2dffeeba.js"><link rel="prefetch" href="/xiaper.io/assets/js/23.ef9148ee.js"><link rel="prefetch" href="/xiaper.io/assets/js/24.62f35fe5.js"><link rel="prefetch" href="/xiaper.io/assets/js/25.7158a91a.js"><link rel="prefetch" href="/xiaper.io/assets/js/26.484c6f24.js"><link rel="prefetch" href="/xiaper.io/assets/js/27.d18018b2.js"><link rel="prefetch" href="/xiaper.io/assets/js/28.234eaef3.js"><link rel="prefetch" href="/xiaper.io/assets/js/29.59cdf3b9.js"><link rel="prefetch" href="/xiaper.io/assets/js/3.6a66b326.js"><link rel="prefetch" href="/xiaper.io/assets/js/30.ffbfab4e.js"><link rel="prefetch" href="/xiaper.io/assets/js/31.7c70cc19.js"><link rel="prefetch" href="/xiaper.io/assets/js/32.2c075904.js"><link rel="prefetch" href="/xiaper.io/assets/js/33.05a89d34.js"><link rel="prefetch" href="/xiaper.io/assets/js/34.5527c3d0.js"><link rel="prefetch" href="/xiaper.io/assets/js/35.494b7d7e.js"><link rel="prefetch" href="/xiaper.io/assets/js/36.6ac75d66.js"><link rel="prefetch" href="/xiaper.io/assets/js/37.060312dc.js"><link rel="prefetch" href="/xiaper.io/assets/js/38.cbf54f37.js"><link rel="prefetch" href="/xiaper.io/assets/js/39.29dfb944.js"><link rel="prefetch" href="/xiaper.io/assets/js/4.6ae4d23f.js"><link rel="prefetch" href="/xiaper.io/assets/js/40.83e12f85.js"><link rel="prefetch" href="/xiaper.io/assets/js/41.5d6c4f47.js"><link rel="prefetch" href="/xiaper.io/assets/js/42.1eb7231e.js"><link rel="prefetch" href="/xiaper.io/assets/js/43.33f3e346.js"><link rel="prefetch" href="/xiaper.io/assets/js/44.51ffc90f.js"><link rel="prefetch" href="/xiaper.io/assets/js/45.940c592b.js"><link rel="prefetch" href="/xiaper.io/assets/js/46.382291ed.js"><link rel="prefetch" href="/xiaper.io/assets/js/47.4182ece7.js"><link rel="prefetch" href="/xiaper.io/assets/js/48.0cf60d05.js"><link rel="prefetch" href="/xiaper.io/assets/js/49.36a68fa5.js"><link rel="prefetch" href="/xiaper.io/assets/js/5.a86f1e06.js"><link rel="prefetch" href="/xiaper.io/assets/js/50.ad31ef1a.js"><link rel="prefetch" href="/xiaper.io/assets/js/51.279fa9a2.js"><link rel="prefetch" href="/xiaper.io/assets/js/52.509e684b.js"><link rel="prefetch" href="/xiaper.io/assets/js/53.5782efa1.js"><link rel="prefetch" href="/xiaper.io/assets/js/54.b9e32e6a.js"><link rel="prefetch" href="/xiaper.io/assets/js/55.89e27d37.js"><link rel="prefetch" href="/xiaper.io/assets/js/56.74a81dc2.js"><link rel="prefetch" href="/xiaper.io/assets/js/57.c3ede784.js"><link rel="prefetch" href="/xiaper.io/assets/js/58.3b8af03b.js"><link rel="prefetch" href="/xiaper.io/assets/js/59.073fc798.js"><link rel="prefetch" href="/xiaper.io/assets/js/6.452ea5b0.js"><link rel="prefetch" href="/xiaper.io/assets/js/60.277ed3f9.js"><link rel="prefetch" href="/xiaper.io/assets/js/61.7f1fde1c.js"><link rel="prefetch" href="/xiaper.io/assets/js/62.a2dffaff.js"><link rel="prefetch" href="/xiaper.io/assets/js/63.fd57d6d2.js"><link rel="prefetch" href="/xiaper.io/assets/js/64.0fedcd02.js"><link rel="prefetch" href="/xiaper.io/assets/js/65.985543c4.js"><link rel="prefetch" href="/xiaper.io/assets/js/66.34927d63.js"><link rel="prefetch" href="/xiaper.io/assets/js/67.bb356832.js"><link rel="prefetch" href="/xiaper.io/assets/js/68.6fc21b0a.js"><link rel="prefetch" href="/xiaper.io/assets/js/69.4ae44d80.js"><link rel="prefetch" href="/xiaper.io/assets/js/7.de9deeac.js"><link rel="prefetch" href="/xiaper.io/assets/js/70.7297fe0a.js"><link rel="prefetch" href="/xiaper.io/assets/js/71.cc03ddfc.js"><link rel="prefetch" href="/xiaper.io/assets/js/8.01f4021c.js"><link rel="prefetch" href="/xiaper.io/assets/js/9.ca6dab5f.js">
    <link rel="stylesheet" href="/xiaper.io/assets/css/0.styles.111411e0.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/xiaper.io/" class="home-link router-link-active"><!----> <span class="site-name">虾婆</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/xiaper.io/" class="nav-link">首页</a></div><div class="nav-item"><a href="/xiaper.io/guide/" class="nav-link">指南</a></div><div class="nav-item"><a href="/xiaper.io/other/about.html" class="nav-link">关于</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">APIs</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="http://www.xiaper.io/docs/ios/core-api/html/index.html" target="_blank" rel="noopener noreferrer" class="nav-link external">
  iOS core-sdk-api
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="http://www.xiaper.io/docs/ios/ui-api/html/index.html" target="_blank" rel="noopener noreferrer" class="nav-link external">
  iOS ui-sdk-api
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="http://www.xiaper.io/docs/android/core-api" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Android core-sdk-api
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="http://www.xiaper.io/docs/android/ui-api" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Android ui-sdk-api
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="http://www.xiaper.io/docs/web/im-api" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Web im-sdk-api
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="http://www.xiaper.io/docs/web/kf-api" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Web kefu-sdk-api
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div><div class="nav-item"><a href="http://www.xiaper.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  虾婆云
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">其他</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="http://www.weikefu.net" target="_blank" rel="noopener noreferrer" class="nav-link external">
  微客服
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="http://www.bytedesk.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  萝卜丝
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="http://www.xiaper.im" target="_blank" rel="noopener noreferrer" class="nav-link external">
  虾信
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="http://www.xiaqun.im" target="_blank" rel="noopener noreferrer" class="nav-link external">
  虾群
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">选择语言</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/xiaper.io/component/keepalived.html" class="nav-link router-link-exact-active router-link-active">简体中文</a></li><li class="dropdown-item"><!----> <a href="/xiaper.io/en/" class="nav-link">English</a></li></ul></div></div> <a href="https://github.com/xiaper/docs" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/xiaper.io/" class="nav-link">首页</a></div><div class="nav-item"><a href="/xiaper.io/guide/" class="nav-link">指南</a></div><div class="nav-item"><a href="/xiaper.io/other/about.html" class="nav-link">关于</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">APIs</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="http://www.xiaper.io/docs/ios/core-api/html/index.html" target="_blank" rel="noopener noreferrer" class="nav-link external">
  iOS core-sdk-api
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="http://www.xiaper.io/docs/ios/ui-api/html/index.html" target="_blank" rel="noopener noreferrer" class="nav-link external">
  iOS ui-sdk-api
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="http://www.xiaper.io/docs/android/core-api" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Android core-sdk-api
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="http://www.xiaper.io/docs/android/ui-api" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Android ui-sdk-api
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="http://www.xiaper.io/docs/web/im-api" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Web im-sdk-api
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="http://www.xiaper.io/docs/web/kf-api" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Web kefu-sdk-api
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div><div class="nav-item"><a href="http://www.xiaper.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  虾婆云
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">其他</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="http://www.weikefu.net" target="_blank" rel="noopener noreferrer" class="nav-link external">
  微客服
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="http://www.bytedesk.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  萝卜丝
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="http://www.xiaper.im" target="_blank" rel="noopener noreferrer" class="nav-link external">
  虾信
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="http://www.xiaqun.im" target="_blank" rel="noopener noreferrer" class="nav-link external">
  虾群
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">选择语言</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/xiaper.io/component/keepalived.html" class="nav-link router-link-exact-active router-link-active">简体中文</a></li><li class="dropdown-item"><!----> <a href="/xiaper.io/en/" class="nav-link">English</a></li></ul></div></div> <a href="https://github.com/xiaper/docs" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span></span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/xiaper.io/guide/" class="sidebar-link">介绍</a></li><li><a href="/xiaper.io/guide/server.html" class="sidebar-link">服务器</a></li><li><a href="/xiaper.io/guide/ios.html" class="sidebar-link">iOS</a></li><li><a href="/xiaper.io/guide/android.html" class="sidebar-link">Android</a></li><li><a href="/xiaper.io/guide/web.html" class="sidebar-link">Web/H5</a></li><li><a href="/xiaper.io/guide/pc.html" class="sidebar-link">Windows/Mac/Linux</a></li><li><a href="/xiaper.io/guide/mp.html" class="sidebar-link">公众号</a></li><li><a href="/xiaper.io/guide/mini.html" class="sidebar-link">小程序</a></li><li><a href="/xiaper.io/guide/webrtc.html" class="sidebar-link">音视频</a></li><li><a href="/xiaper.io/guide/flutter.html" class="sidebar-link">Flutter</a></li><li><a href="/xiaper.io/guide/tensorflow.html" class="sidebar-link">智能问答</a></li><li><a href="/xiaper.io/guide/callcenter.html" class="sidebar-link">呼叫中心</a></li><li><a href="/xiaper.io/guide/jmeter.html" class="sidebar-link">性能数据</a></li><li><a href="/xiaper.io/guide/admin.html" class="sidebar-link">管理后台</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>组件</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/xiaper.io/component/activemq.html" class="sidebar-link">ActiveMQ</a></li><li><a href="/xiaper.io/component/mysql.html" class="sidebar-link">MySQL</a></li><li><a href="/xiaper.io/component/nginx.html" class="sidebar-link">Nginx</a></li><li><a href="/xiaper.io/component/oracle.html" class="sidebar-link">Oracle</a></li><li><a href="/xiaper.io/component/rabbitmq.html" class="sidebar-link">RabbitMQ</a></li><li><a href="/xiaper.io/component/redis.html" class="sidebar-link">Redis</a></li><li><a href="/xiaper.io/component/haproxy.html" class="sidebar-link">HAProxy</a></li><li><a href="/xiaper.io/component/keepalived.html" class="active sidebar-link">KeepAlived</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/xiaper.io/component/keepalived.html#安装" class="sidebar-link">安装</a></li><li class="sidebar-sub-header"><a href="/xiaper.io/component/keepalived.html#配置" class="sidebar-link">配置</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/xiaper.io/component/keepalived.html#微信公众号" class="sidebar-link">微信公众号</a></li></ul></li><li class="sidebar-sub-header"><a href="/xiaper.io/component/keepalived.html#参考" class="sidebar-link">参考</a></li></ul></li><li><a href="/xiaper.io/component/quartz.html" class="sidebar-link">Quartz</a></li><li><a href="/xiaper.io/component/freeswitch.html" class="sidebar-link">FreeSwitch</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>通信协议</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>其他</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="content default"><h1 id="keepalived"><a href="#keepalived" aria-hidden="true" class="header-anchor">#</a> KeepAlived</h1> <p>仅供参考，如果使用阿里云/腾讯云等云服务，建议直接购买其负载均衡服务即可</p> <h2 id="安装"><a href="#安装" aria-hidden="true" class="header-anchor">#</a> 安装</h2> <ul><li><a href="https://www.keepalived.org/download.html" target="_blank" rel="noopener noreferrer">下载<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">tar</span> -zxvf keepalived-2.0.15.tar.gz
<span class="token function">cd</span> keepalived-2.0.15
<span class="token function">mkdir</span> -p /usr/local/keepalived
./configure --prefix<span class="token operator">=</span>/usr/local/keepalived
<span class="token function">make</span> <span class="token operator">&amp;&amp;</span> <span class="token function">make</span> <span class="token function">install</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># keepalived启动脚本变量引用文件，默认文件路径是/etc/sysconfig/，也可以不做软链接，直接修改启动脚本中文件路径即可（安装目录下）</span>
<span class="token function">mkdir</span> /etc/sysconfig
<span class="token function">cp</span> /usr/local/keepalived/etc/sysconfig/keepalived  /etc/sysconfig/keepalived
<span class="token comment"># 将keepalived主程序加入到环境变量（安装目录下）</span>
<span class="token function">cp</span> /usr/local/keepalived/sbin/keepalived /usr/sbin/keepalived
<span class="token comment"># keepalived启动脚本（源码目录下），放到/etc/init.d/目录下就可以使用service命令便捷调用</span>
<span class="token function">cp</span> /usr/local/keepalived/sbin/keepalived  /etc/init.d/keepalived
<span class="token comment"># 将配置文件放到默认路径下</span>
<span class="token function">mkdir</span> /etc/keepalived
<span class="token function">cp</span> /usr/local/keepalived/etc/keepalived/keepalived.conf /etc/keepalived/keepalived.conf
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h2 id="配置"><a href="#配置" aria-hidden="true" class="header-anchor">#</a> 配置</h2> <img src="/xiaper.io/image/keepalived.png" style="width:250px;"> <p>如图所示，两台Keepalived服务器之间通过VRRP进行交互，对外部虚拟出一个VIP为192.168.0.10。Keepalived与HAProxy部署在同一台机器上，两个Keepalived服务实例匹配两个HAProxy服务实例，这样通过Keeaplived实现HAProxy的双机热备。所以在上一小节的192.168.0.9的基础之上，还要再部署一台HAProxy服务，IP地址为192.168.0.8。整条调用链路为：客户端通过VIP建立通信链路；通信链路通过Keeaplived的Master节点路由到对应的HAProxy之上；HAProxy通过负载均衡算法将负载分发到集群中的各个节点之上。正常情况下客户端的连接通过图中左侧部分进行负载分发。当Keepalived的Master节点挂掉或者HAProxy挂掉无法恢复，那么Backup提升为Master，客户端的连接通过图中右侧部分进行负载分发。如果你追求要更高的可靠性，可以加入多个Backup角色的Keepalived节点来实现一主多从的多机热备。当然这样会提升硬件资源的成本，该如何抉择需要更细致的考恒，一般情况下双机热备的配备已足够满足应用需求。</p> <p>接下来我们要修改/etc/keepalived/keepalived.conf文件. 在两台机器上，分别配置主备。Keepalived MASTER 配置文件</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token comment">#全局定义块</span>
global_defs <span class="token punctuation">{</span>
  <span class="token comment"># 用于服务有故障时发送邮件报警，可选项，不建议用. 需要系统开启sendmail服务，建议用第三独立监控服务，如用nagios全面监控代替</span>
  <span class="token comment"># notification_email {</span>
  <span class="token comment">#   270580156@qq.com</span>
  <span class="token comment">#   2939499399@qq.com</span>
  <span class="token comment"># }</span>
  <span class="token comment"># notification_email_from bytedesk@163.com</span>
  <span class="token comment"># smtp_server smtp.163.com</span>
  <span class="token comment"># smtp_connect_timeout 10000</span>
  <span class="token comment"># lvs负载均衡器标识，在一个网络内，它的值应该是唯一的</span>
  <span class="token comment"># lvs_id string</span>
  <span class="token comment"># 标识本节点的字条串,通常为hostname</span>
  <span class="token comment"># 此为主服务器配置，从服务器上面需要修改为 BYTEDESK_SLAVE 或其他</span>
  router_id BYTEDESK_MASTER
<span class="token punctuation">}</span>

<span class="token comment">#Haproxy服务启动, 监测haproxy进程状态，健康检查，每2秒执行一次</span>
vrrp_script chk_haproxy <span class="token punctuation">{</span>
  <span class="token comment">#监控haproxy进程的脚本, 根据自己的实际路径放置</span>
  script <span class="token string">&quot;/etc/keepalived/check_haproxy.sh&quot;</span>
  <span class="token comment">#每两秒进行一次</span>
  interval 2
  <span class="token comment">#如果script中的指令执行失败，vrrp_instance的优先级会减少4个点</span>
  weight -4
<span class="token punctuation">}</span>

vrrp_instance VI_1 <span class="token punctuation">{</span>
  <span class="token comment"># 实例状态，只有MASTER 和 BACKUP两种状态，并且需要全部大写</span>
  <span class="token comment">#主机为MASTER，备机为BACKUP</span>
  state MASTER
  <span class="token comment">#主备机必须相同</span>
  <span class="token comment">#取值在0-255之间，用来区分多个instance的VRRP组播，同一网段中virtual_router_id的值不能重复，否则会出错。</span>
  virtual_router_id 51
  <span class="token comment"># 对外提供服务的网卡接口，即VIP绑定的网卡接口</span>
  <span class="token comment"># 监测网络端口，用ipconfig查看, 服务器固有IP（非VIP）的网卡</span>
  interface eth0
  <span class="token comment"># 本机IP地址, MASTER服务器IP,从服务器写从服务器的IP</span>
  <span class="token comment"># mcast_src_ip @IP</span>
  <span class="token comment"># 节点优先级，取值范围0～254，MASTER要比BACKUP高</span>
  <span class="token comment">#主备机取不同的优先级，主机要大。从服务器上改为50</span>
  <span class="token comment">#用来选举master的，要成为master，那么这个选项的值最好高于其他机器50个点。此时，从服务器要低于100；</span>
  priority 100
  <span class="token comment">#VRRP Multicast广播周期秒数</span>
  <span class="token comment"># MASTER与BACKUP节点间同步检查的时间间隔，单位为秒</span>
  advert_int 1
  <span class="token comment"># 禁止抢占服务</span>
  <span class="token comment"># nopreempt</span>
  <span class="token comment"># 有故障时是否激活邮件通知</span>
  <span class="token comment"># smtp_alert</span>
  <span class="token comment"># lvs_sync_daemon_interface string</span>
  <span class="token comment">#认证区域</span>
  authentication <span class="token punctuation">{</span>
    <span class="token comment">#VRRP认证方式, 推荐使用PASS（密码只识别前8位）</span>
    auth_type PASS
    <span class="token comment">#VRRP口令 主备机密码必须相同</span>
    auth_pass 12345678
  <span class="token punctuation">}</span>
  <span class="token comment">#调用haproxy进程检测脚本</span>
  track_script <span class="token punctuation">{</span>
    chk_haproxy
  <span class="token punctuation">}</span>
   <span class="token comment">#VIP 漂移地址 即集群IP地址, 可以设置多个</span>
  virtual_ipaddress <span class="token punctuation">{</span>
    192.168.0.10
    <span class="token comment"># 172.16.0.222/16 dev eth0 label eth0:1</span>
  <span class="token punctuation">}</span>
  <span class="token comment"># unicast_src_ip 172.16.0.224</span>
  <span class="token comment"># unicast_peer {</span>
  <span class="token comment">#   172.16.0.225</span>
  <span class="token comment"># }</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br></div></div><p>Keepalived BACKUP 配置文件</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token comment">#全局定义块</span>
global_defs <span class="token punctuation">{</span>
  router_id BYTEDESK_BACKUP
<span class="token punctuation">}</span>

<span class="token comment">#Haproxy服务启动, 监测haproxy进程状态，健康检查，每2秒执行一次</span>
vrrp_script chk_haproxy <span class="token punctuation">{</span>
  <span class="token comment">#监控haproxy进程的脚本, 根据自己的实际路径放置</span>
  script <span class="token string">&quot;/etc/keepalived/check_haproxy.sh&quot;</span>
  <span class="token comment">#每两秒进行一次</span>
  interval 2
  <span class="token comment">#如果script中的指令执行失败，vrrp_instance的优先级会减少4个点</span>
  weight -4
<span class="token punctuation">}</span>

vrrp_instance VI_1 <span class="token punctuation">{</span>
  state BACKUP
  <span class="token comment">#主备机必须相同</span>
  virtual_router_id 51
  interface eth0
  priority 50
  advert_int 1
  <span class="token comment">#认证区域</span>
  authentication <span class="token punctuation">{</span>
    <span class="token comment">#VRRP认证方式, 推荐使用PASS（密码只识别前8位）</span>
    auth_type PASS
    <span class="token comment">#VRRP口令 主备机密码必须相同</span>
    auth_pass 12345678
  <span class="token punctuation">}</span>
  <span class="token comment">#调用haproxy进程检测脚本</span>
  track_script <span class="token punctuation">{</span>
    chk_haproxy
  <span class="token punctuation">}</span>
   <span class="token comment">#VIP 漂移地址 即集群IP地址, 可以设置多个</span>
  virtual_ipaddress <span class="token punctuation">{</span>
    192.168.0.10
    <span class="token comment"># 172.16.0.222/16 dev eth0 label eth0:1</span>
  <span class="token punctuation">}</span>
  <span class="token comment"># unicast_src_ip 172.16.0.225</span>
  <span class="token comment"># unicast_peer {</span>
  <span class="token comment">#   172.16.0.224</span>
  <span class="token comment"># }</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br></div></div><p>为了防止HAProxy服务挂了，但是Keepalived却还在正常工作而没有切换到Backup上，所以这里需要编写一个脚本来检测HAProxy服务的状态。当HAProxy服务挂掉之后该脚本会自动重启HAProxy的服务，如果不成功则关闭Keepalived服务，如此便可以切换到Backup继续工作。</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># 编辑文件check_haproxy.sh</span>
<span class="token function">vi</span> /etc/keepalived/check_haproxy.sh
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># check_haproxy.sh文件内容</span>
<span class="token comment">#!/bin/bash</span>
<span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token variable"><span class="token variable">$(</span><span class="token function">ps</span> -C haproxy --no-header <span class="token operator">|</span> <span class="token function">wc</span> -l<span class="token variable">)</span></span> -eq 0 <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
   /usr/local/haproxy/sbin/haproxy -f /usr/local/haproxy/conf/haproxy.cfg
   <span class="token function">sleep</span> 3

   <span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token variable"><span class="token variable">$(</span><span class="token function">ps</span> -C haproxy --no-header <span class="token operator">|</span> <span class="token function">wc</span> -l<span class="token variable">)</span></span> -eq 0 <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
      /etc/init.d/keepalived stop
   <span class="token keyword">fi</span>
<span class="token keyword">fi</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># 此文件root组读写权限,并且允许程序执行此文件</span>
<span class="token function">chmod</span> 777 /etc/keepalived/check_haproxy.sh
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># 查看keepalived状况</span>
<span class="token function">service</span> keepalived status
<span class="token comment"># 启动、关闭、重启</span>
<span class="token function">service</span> keepalived start
<span class="token function">service</span> keepalived stop
<span class="token function">service</span> keepalived restart
<span class="token comment"># 查看Keepalived生成的VIP是否与主服务器绑定</span>
ip addr
<span class="token comment"># 查看log消息:</span>
<span class="token function">tail</span> -f /var/log/messages
<span class="token comment"># 停止</span>
<span class="token function">killall</span> keepalived
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># 可选部分，可忽略</span>
<span class="token comment"># 加为系统服务</span>
<span class="token comment"># chkconfig –-add keepalived</span>
<span class="token comment"># 开机启动</span>
<span class="token comment"># chkconfig keepalived on</span>
<span class="token comment"># 查看开机启动的服务</span>
<span class="token comment"># chkconfig –list</span>
<span class="token comment">#</span>
<span class="token comment"># ubuntu: chkconfig: command not found 解决方案：</span>
<span class="token comment"># ubuntu中chkconfig已经被sysv-rc-conf替代，具体如下操作如下</span>
<span class="token comment"># sudo apt install sysv-rc-conf</span>
<span class="token comment"># sudo cp /usr/sbin/sysv-rc-conf /usr/sbin/chkconfig</span>
<span class="token comment"># sysv-rc-conf keepalived on</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h3 id="微信公众号"><a href="#微信公众号" aria-hidden="true" class="header-anchor">#</a> 微信公众号</h3> <img src="/xiaper.io/image/qrcode_xiaperio_430.jpg" style="width:250px;"> <h2 id="参考"><a href="#参考" aria-hidden="true" class="header-anchor">#</a> 参考</h2> <ul><li><a href="https://www.keepalived.org/" target="_blank" rel="noopener noreferrer">KeepAlived<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://blog.csdn.net/bbwangj/article/details/80346428" target="_blank" rel="noopener noreferrer">Linux下Keepalived安装与配置<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://blog.csdn.net/u013256816/article/details/77171017" target="_blank" rel="noopener noreferrer">RabbitMQ负载均衡（3）——Keepalived+HAProxy实现高可用的负载均衡<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://yq.aliyun.com/articles/438705" target="_blank" rel="noopener noreferrer">在阿里云VPC环境中利用keepalived实现主备双机高可用<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/xiaper/docs/edit/master/vuepress/docs/component/keepalived.md" target="_blank" rel="noopener noreferrer">在 GitHub 上编辑此页</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <div class="last-updated"><span class="prefix">上次更新: </span> <span class="time">2019-5-8 13:59:30</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/xiaper.io/component/haproxy.html" class="prev">
          HAProxy
        </a></span> <span class="next"><a href="/xiaper.io/component/quartz.html">
          Quartz
        </a>
        →
      </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/xiaper.io/assets/js/app.8a36be63.js" defer></script><script src="/xiaper.io/assets/js/2.00a3d842.js" defer></script><script src="/xiaper.io/assets/js/20.570c8361.js" defer></script>
  </body>
</html>
